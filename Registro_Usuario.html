<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro - Cusco Reporta</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* Mismo estilo que login.html */
    body { font-family: "Poppins", sans-serif; }
    .page-wrap{
      min-height: calc(100vh - 80px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 40px 16px;
      background: radial-gradient(circle at top, #7b0000 0%, #3b0000 60%, #1c0000 100%);
    }
    .auth-card{
      width: min(920px, 96vw);
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding: 26px 22px 22px;
    }
    .auth-header{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 10px;
      text-align:center;
      margin-bottom: 18px;
    }
    .auth-header img{ height: 48px; object-fit: contain; }
    .auth-header h1{ margin:0; color:#8b0000; font-size:1.55rem; }
    .auth-header p{ margin:0; color:#555; font-size:.95rem; }
    
    .toggle-row{ display:flex; justify-content:center; margin:18px 0 22px; }
    .toggle{
      display:flex;
      border-radius:999px;
      overflow:hidden;
      box-shadow:0 2px 10px rgba(0,0,0,.08);
    }
    .toggle a{
      padding:10px 18px;
      text-decoration:none;
      font-weight:700;
      color:#fff;
      display:flex;
      align-items:center;
      gap:8px;
      background:#8b0000;
      opacity:1;
    }
    .toggle a:not(.active){ background:#c43d3d; opacity:.9; }
    
    .form{ width:min(420px, 100%); margin:0 auto; }
    .form-group{ margin-bottom:16px; }
    .form-label{
      display:block;
      font-weight:700;
      margin-bottom:8px;
      color:#333;
    }
    .form-input{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid #ddd;
      background:#f8f9fa;
      outline:none;
      font-weight:600;
    }
    .form-input:focus{ border-color:#8b0000; background:#fff; }
    
    .submit-btn{
      width:100%;
      border:none;
      background:#8b0000;
      color:#fff;
      padding:12px 16px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      transition:transform .05s ease;
    }
    .submit-btn:active{ transform:scale(.99); }
    
    .links{
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .links a{ color:#8b0000; text-decoration:none; font-weight:700; }
    
    .footer-msg{
      text-align:center;
      margin-top:18px;
      color:#666;
      font-weight:700;
      letter-spacing:.5px;
    }
    
    .form-row{
      display:flex;
      gap:15px;
    }
    .form-row .form-group{
      flex:1;
    }
    
    @media (max-width:600px){
      .auth-card{ padding:20px 16px 18px; }
      .form-row{ flex-direction:column; gap:16px; }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="navbar__left" style="display:flex; align-items:center; gap:10px;">
      <img src="../assents/images/CuscoReporta.png" alt="Logo Cusco Reporta" class="navbar__logo">
    </div>
    <nav class="navbar__menu">
      <a href="index.html">Inicio</a>
      <a href="registrar_tu_denuncia.html">Registra tu denuncia</a>
      <a href="sobre_nosotros.html">Sobre nosotros</a>
      <a href="iniciar-sesion.html">Iniciar Sesi√≥n</a>
      <a href="ayuda.html">Ayuda</a>
    </nav>
  </header>

  <main class="page-wrap">
    <section class="auth-card">
      <div class="auth-header">
        <img src="../assents/images/CuscoReporta.png" alt="Cusco Reporta">
        <h1>REGISTRO DE USUARIO</h1>
        <p>Crea tu cuenta para acceder a todas las funciones</p>
      </div>

      <div class="toggle-row">
        <div class="toggle">
          <a href="iniciar-sesion.html">üîê Iniciar Sesi√≥n</a>
          <a href="Registro_Usuario.html" class="active">üè¨ Registrarse</a>
        </div>
      </div>

     <!-- En Registro_Usuario.html -->
<form id="formRegistro" class="form">
  <div class="form-group">
    <label for="regNombre" class="form-label">
      <i class="fas fa-user"></i> Nombre Completo *
    </label>
    <input type="text" id="regNombre" class="form-input" 
           placeholder="Juan P√©rez Garc√≠a" required>
  </div>

  <div class="form-group">
    <label for="regEmail" class="form-label">
      <i class="fas fa-envelope"></i> Email *
    </label>
    <input type="email" id="regEmail" class="form-input" 
           placeholder="tu@email.com" required>
  </div>

  <div class="form-group">
    <label for="regPassword" class="form-label">
      <i class="fas fa-lock"></i> Contrase√±a *
    </label>
    <input type="password" id="regPassword" class="form-input" 
           placeholder="M√≠nimo 6 caracteres" minlength="6" required>
  </div>

  <div class="form-group">
    <label for="regConfirmPassword" class="form-label">
      <i class="fas fa-lock"></i> Confirmar Contrase√±a *
    </label>
    <input type="password" id="regConfirmPassword" class="form-input" 
           placeholder="Repite tu contrase√±a" minlength="6" required>
  </div>

  <div class="form-group">
    <label style="font-size: 0.9rem; color: #666;">
      <input type="checkbox" id="regTerminos" required>
      Acepto los t√©rminos y condiciones
    </label>
  </div>

  <button type="submit" class="submit-btn" id="btnRegistro">
    <i class="fas fa-user-plus"></i> Crear Cuenta
  </button>
</form>

<script src="../js/auth.js"></script>
<script>
  document.getElementById('formRegistro').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const nombre = document.getElementById('regNombre').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regConfirmPassword').value;
    const btnRegistro = document.getElementById('btnRegistro');
    
    // Validaciones
    if (!nombre || !email || !password) {
      window.supabaseAuth.mostrarNotificacion('Completa todos los campos', 'error');
      return;
    }
    
    if (password !== confirmPassword) {
      window.supabaseAuth.mostrarNotificacion('Las contrase√±as no coinciden', 'error');
      return;
    }
    
    if (password.length < 6) {
      window.supabaseAuth.mostrarNotificacion('La contrase√±a debe tener al menos 6 caracteres', 'error');
      return;
    }
    
    // Cambiar estado del bot√≥n
    const originalHTML = btnRegistro.innerHTML;
    btnRegistro.innerHTML = '<i class="fas fa-spinner auth-loading"></i> Registrando...';
    btnRegistro.disabled = true;
    
    try {
      const resultado = await window.supabaseAuth.registrarUsuario(
        email, 
        password, 
        { nombre: nombre }
      );
      
      if (resultado.success) {
        window.supabaseAuth.mostrarNotificacion(
          '¬°Registro exitoso! Revisa tu email para verificar.', 
          'success'
        );
        
        // Redirigir a login despu√©s de 3 segundos
        setTimeout(() => {
          window.location.href = `iniciar-sesion.html?registro=exitoso&email=${encodeURIComponent(email)}`;
        }, 3000);
        
      } else {
        throw new Error(resultado.error);
      }
      
    } catch (error) {
      window.supabaseAuth.mostrarNotificacion(
        `Error: ${error.message}`, 
        'error'
      );
      
    } finally {
      btnRegistro.innerHTML = originalHTML;
      btnRegistro.disabled = false;
    }
  });
</script>
